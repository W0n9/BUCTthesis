% This package is used for taskbook of bachelors' thesis for BUCT.
%
\ProvidesPackage{bucttaskbook}[2023/05/20]
\RequirePackage{kvoptions}
\DeclareDefaultOption{\PassOptionsToClass{\CurrentOption}{ctexbook}}
\ProcessKeyvalOptions*
\PassOptionsToPackage{quiet}{xeCJK}

\RequirePackage{
	amsmath,
	geometry,
	fancyhdr,
	graphicx,
	enumitem,
	booktabs,
	siunitx,
	tabularx,
	array,
	caption,
	float,
	pdfpages,
	zhlipsum,
}
\RequirePackage[sort&compress]{gbt7714}
\RequirePackage[version=4]{mhchem}
\RequirePackage{hyperref}

%%% 选项
\newcommand{\buct@def@key}[1]{
    \@namedef{#1}##1{\@namedef{buct@#1}{##1}}
    \define@key{buct}{#1}{\@nameuse{#1}{##1}}
}
\newcommand{\buctsetup}[1]{\kvsetkeys{buct}{#1}}
\buct@def@key{ctitle}
\buct@def@key{cauthor}
\buct@def@key{class}
\buct@def@key{school}
\buct@def@key{major}
\buct@def@key{supervisor}
\buct@def@key{msupervisor}

%%% 页面设置
\geometry{%
	a4paper,nomarginpar,
	top = 3cm, bottom = 2.6cm, left = 2.5cm, right = 3cm,
	headheight = 1cm, footskip = 0.6cm,
}
\pagestyle{empty}

%%% 行距
\linespread{1.5221}

%%% 常量定义
\newcommand\buct@task@title{本科生毕业设计（论文）任务书}
\newcommand\buct@task@pdf{任务书}
\newcommand\buct@task@ctitle{设计（论文）题目：}
\newcommand\buct@task@school{学院：}
\newcommand\buct@task@major{专业：}
\newcommand\buct@task@class{班级：}
\newcommand\buct@task@student{学生：}
\newcommand\buct@task@supervisor{指导教师（含职称）：}
\newcommand\buct@task@msupervisor{专业负责人：}
\newcommand\buct@task@itema{1.设计（论文）的主要任务及目标}
\newcommand\buct@task@itemb{2.设计（论文）的基本要求和内容}
\newcommand\buct@task@itemc{3.主要参考文献}
\newcommand\buct@task@itemd{4.进度安排}

%%% 字体配置
\setCJKmainfont{SimSun}[AutoFakeBold,AutoFakeSlant]
\setCJKsansfont{SimHei}[AutoFakeBold]
\setmainfont{Times New Roman}

%%% 定义环境
\newenvironment{taskbook}{%
    \section*{\buct@task@title}%
}{\clearpage}
    \NewDocumentCommand{\buct@ul}{ o m }{\underline{\makebox[#1][c]{#2}}}
    \NewDocumentCommand\taskinfo{ s }{%
        \noindent%
        \begin{minipage}{\textwidth}%
            \punctstyle{plain}\linespread{1.94}%
                \buct@task@ctitle\buct@ul[27em]{\buct@ctitle}\\[3pt]
            \IfBooleanTF{#1}{% less lines break
                \buct@task@school\buct@ul[10em]{\buct@school}\quad
                \buct@task@major\buct@ul[10em]{\buct@major}\quad
                \buct@task@class\buct@ul[5em]{\buct@class}\\[3pt]
                \buct@task@student\buct@ul[5em]{\buct@cauthor}\quad
                \buct@task@supervisor\buct@ul[6em]{\buct@supervisor}\quad
                \buct@task@msupervisor\buct@ul[4em]{\buct@msupervisor}%
            }{% more lines break
                \buct@task@school\buct@ul[15em]{\buct@school}\qquad
                \buct@task@major\buct@ul[13em]{\buct@major}\\[3pt]
                \buct@task@class\buct@ul[15em]{\buct@class}\qquad
                \buct@task@student\buct@ul[13em]{\buct@cauthor}\\[3pt]
                \buct@task@supervisor\buct@ul[8em]{\buct@supervisor}\qquad
                \buct@task@msupervisor\buct@ul[10em]{\buct@msupervisor}%
            }
        \end{minipage}\vspace{1.5em}
    }
    \newcounter{taskitemcnt}
    \newcommand{\buct@taskitem}{%
        \stepcounter{taskitemcnt}%
        \ifcase\value{taskitemcnt}\relax\or%
        {\buct@task@itema}\or%
        {\buct@task@itemb}\or%
        {\buct@task@itemc}\or%
        {\buct@task@itemd}\else%
        \ClassError{buctthesis}{Too many \protect\taskitem\space used}%
        {Keep \protect\taskitem\space no more than 4 times.}\fi
    }
    \newcommand{\taskitem}{\vspace{1em}\noindent\buct@taskitem\par}

%%% 参考文献列表
\newenvironment{bibenumerate}{%
	\begin{enumerate}[label={[\arabic*]},leftmargin=3em]
}{\end{enumerate}}

%%% 其他
\urlstyle{same}